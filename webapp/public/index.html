<html lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script defer src="/__/firebase/4.8.0/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/4.8.0/firebase-auth.js"></script>
  <script defer src="/__/firebase/4.8.0/firebase-database.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="/__/firebase/init.js"></script>

  <!-- Angular Material style sheet -->
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.4/angular-material.min.css">
</head>

<body ng-app="DoorBell" ng-cloak>
  
  <div ng-controller="mainCtrl" layout="column" style="height: 100%">
    <md-toolbar class="primary">
      <div style="padding: 16px">DoorBell</div>
    </md-toolbar>
    <md-content flex layout-padding>
      <md-card ng-repeat="image in images">
        <img src="data:image/jpeg;base64,{{image.image}}" class="md-card-image">
        <md-card-title>{{image.timestamp}}</md-card-title>
      </md-card>
    </md-content>
  </div>


  <!-- Angular Material requires Angular.js Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>

  <script src="https://cdn.firebase.com/libs/angularfire/2.3.0/angularfire.min.js"></script>
  
  <!-- Angular Material Library -->
  <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.4/angular-material.min.js"></script>

  <!-- Your application bootstrap  -->
  <script type="text/javascript">    
    /**
     * You must include the dependency on 'ngMaterial' 
     */
    var app = angular.module('DoorBell', ['ngMaterial', 'firebase']);

    app.controller('mainCtrl', function($scope, $firebaseArray) {
      
      // $scope.Base64DecodeUrl(str){
      //   str = (str + '===').slice(0, str.length + (str.length % 4));
      //   return str.replace(/-/g, '+').replace(/_/g, '/');
      // }
      var ref = firebase.database().ref().child("logs").orderByChild("timestamp").limitToFirst(1);
      $scope.images = $firebaseArray(ref);
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // // ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
      // // The Firebase SDK is initialized and available here!
      //
      // firebase.auth().onAuthStateChanged(user => { });
      // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
      // firebase.messaging().requestPermission().then(() => { });
      // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
      //
      // // ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
      try {
        let app = firebase.app();
      } catch (e) {
        console.error(e);
      }
    });
  </script>

</body>

</html>